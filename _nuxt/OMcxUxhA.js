import{v as b,u as q,c as S,r as v,T as L,a8 as A,U as M,k as a,V as c,n as y,a0 as I,Q as R,l as t,w as k,a9 as g,aa as C,o as s,m as U,d as B,_ as V}from"./BwYGxf8G.js";const z={key:0},E={key:0},H={id:"__preview_loader"},N=b({__name:"ContentPreviewMode",props:{previewToken:{type:String,required:!0},apiURL:{type:String,required:!0},syncPreview:{type:Function,required:!0},requestPreviewSyncAPI:{type:Function,required:!0}},setup(P){const i=P,_=["__nuxt_preview","__preview_enabled"],T=q(),h=S(),m=v(!0),p=v(!1),n=v(!1),o=v("");let r;const w=()=>{C("previewToken").value="",B().query.preview="",window.sessionStorage.removeItem("previewToken"),window.location.reload()},f=async u=>{const e=await i.syncPreview(u);if(n.value!==!0){if(!e){setTimeout(()=>f(u),1e3);return}C("previewToken").value&&(n.value=!0,await h.replace({query:{}}),T.callHook("nuxt-studio:preview:ready"),window.parent&&window.self!==window.parent&&r.disconnect())}};return L(async()=>{r=(await A(()=>import("./BlRhkrN0.js"),[],import.meta.url)).connect(`${i.apiURL}/preview`,{transports:["websocket","polling"],auth:{token:i.previewToken}});let e;r.on("connect",()=>{e=setTimeout(()=>{n.value||(e=setTimeout(()=>{o.value="Preview sync timed out",n.value=!1},3e4),r.emit("draft:requestSync"))},3e4)});const l=()=>{e&&(clearTimeout(e),e=null)};r.on("draft:sync",async d=>{if(l(),!d){try{r.once("draft:ready",()=>{r.emit("draft:requestSync")}),await i.requestPreviewSyncAPI()}catch(x){switch(l(),x.response.status){case 404:o.value="Preview draft not found",n.value=!1;break;default:o.value="An error occurred while syncing preview",n.value=!1}}return}f(d)}),r.on("draft:unauthorized",()=>{l(),o.value="Unauthorized preview token",n.value=!1}),r.on("disconnect",()=>{l()}),document.body.classList.add(..._),r.on("draft:update",d=>{p.value=!0,i.syncPreview(d),p.value=!1})}),M(()=>{document.body.classList.remove(..._)}),(u,e)=>(s(),a("div",null,[m.value?(s(),a("div",{key:0,id:"__nuxt_preview",class:I({__preview_ready:n.value,__preview_refreshing:p.value})},[n.value?(s(),a(R,{key:0},[e[0]||(e[0]=t("svg",{viewBox:"0 0 90 90",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M50.0016 71.0999h29.2561c.9293.0001 1.8422-.241 2.6469-.6992.8047-.4582 1.4729-1.1173 1.9373-1.9109.4645-.7936.7088-1.6939.7083-2.6102-.0004-.9162-.2455-1.8163-.7106-2.6095L64.192 29.713c-.4644-.7934-1.1325-1.4523-1.937-1.9105-.8046-.4581-1.7173-.6993-2.6463-.6993-.9291 0-1.8418.2412-2.6463.6993-.8046.4582-1.4726 1.1171-1.937 1.9105l-5.0238 8.5861-9.8224-16.7898c-.4648-.7934-1.1332-1.4522-1.938-1.9102-.8047-.4581-1.7176-.6992-2.6468-.6992-.9292 0-1.842.2411-2.6468.6992-.8048.458-1.4731 1.1168-1.9379 1.9102L6.56062 63.2701c-.46512.7932-.71021 1.6933-.71061 2.6095-.00041.9163.24389 1.8166.70831 2.6102.46443.7936 1.1326 1.4527 1.93732 1.9109.80473.4582 1.71766.6993 2.64686.6992h18.3646c7.2763 0 12.6422-3.1516 16.3345-9.3002l8.9642-15.3081 4.8015-8.1925 14.4099 24.6083H54.8058l-4.8042 8.1925ZM29.2077 62.899l-12.8161-.0028L35.603 30.0869l9.5857 16.4047-6.418 10.9645c-2.4521 3.9894-5.2377 5.4429-9.563 5.4429Z",fill:"currentColor"})],-1)),e[1]||(e[1]=t("span",null,"Preview mode enabled",-1)),t("button",{onClick:w}," Close ")],64)):c("",!0)],2)):c("",!0),y(g,{name:"preview-loading"},{default:k(()=>[m.value&&!n.value&&!o.value?(s(),a("div",z,[e[4]||(e[4]=t("div",{id:"__preview_background"},null,-1)),t("div",{id:"__preview_loader"},[e[2]||(e[2]=t("svg",{id:"__preview_loading_icon",width:"32",height:"32",viewBox:"0 0 24 24"},[t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 0 0 4.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 0 1-15.357-2m15.357 2H15"})],-1)),e[3]||(e[3]=t("p",null,"Initializing the preview...",-1)),t("button",{onClick:w}," Cancel ")])])):c("",!0)]),_:1}),y(g,{name:"preview-loading"},{default:k(()=>[o.value?(s(),a("div",E,[e[5]||(e[5]=t("div",{id:"__preview_background"},null,-1)),t("div",H,[t("p",null,U(o.value),1),t("button",{onClick:w}," Exit preview ")])])):c("",!0)]),_:1})]))}}),D=V(N,[["__scopeId","data-v-9d027a65"]]);export{D as default};
